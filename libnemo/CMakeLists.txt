CMAKE_MINIMUM_REQUIRED(VERSION 2.6)

PROJECT(nemo)

SET(CPACK_PACKAGE_NAME nemo)
SET(CPACK_PACKAGE_VERSION_MAJOR 0)
SET(CPACK_PACKAGE_VERSION_MINOR 5)
SET(CPACK_PACKAGE_VERSION_PATCH 3)
SET(CPACK_PACKAGE_CONTACT "Andreas Fidjeland <andreas.fidjeland@imperial.ac.uk>")


OPTION(
	INCLUDE_TIMING_API
	"Include API functions for timing (requires boost_date_time library)"
	ON
)

IF(INCLUDE_TIMING_API)
	LIST(APPEND BOOST_COMPONENTS date_time)
ENDIF(INCLUDE_TIMING_API)


OPTION(INCLUDE_EXAMPLES "Build binaries for example networks" ON)
IF(INCLUDE_EXAMPLES)
	LIST(APPEND DIRS examples)
ENDIF(INCLUDE_EXAMPLES)


OPTION(INCLUDE_TESTS "Build testsuite" OFF)
IF(INCLUDE_TESTS)
	LIST(APPEND DIRS test)
ENDIF(INCLUDE_TESTS)


SET(Boost_USE_MULTITHREAD OFF)
FIND_PACKAGE(Boost REQUIRED COMPONENTS ${BOOST_COMPONENTS})

SUBDIRS(src doc api ${DIRS})


SET(CPACK_SOURCE_GENERATOR "TGZ" "ZIP")

SET(VERSION "${CPACK_PACKAGE_VERSION_MAJOR}.${CPACK_PACKAGE_VERSION_MINOR}.${CPACK_PACKAGE_VERSION_PATCH}")
SET(CPACK_SOURCE_PACKAGE_FILE_NAME "${CMAKE_PROJECT_NAME}-${VERSION}")
SET(CPACK_SOURCE_IGNORE_FILES
	"\\\\.gitignore"
	".*swp$"
	"build"
	mpi
	api/autogen
	api/matlab/sources
	"tmp.*"
	${CPACK_SOURCE_IGNORE_FILES})
SET(CPACK_PACKAGE_DESCRIPTION_FILE "${CMAKE_CURRENT_SOURCE_DIR}/README")
SET(CPACK_RESOURCE_FILE_LICENSE "${CMAKE_CURRENT_SOURCE_DIR}/COPYING")

# TODO: get architecture from uname
# TODO: only build this if we're actually on a debian platform
# TODO: make sure we build for appropriate version
#SET(CPACK_GENERATOR "DEB")
#SET(CPACK_PACKAGE_FILE_NAME "${CPACK_PACKAGE_NAME}-${VERSION}-${CMAKE_HOST_SYSTEM}")
#SET(CPACK_PACKAGE_FILE_NAME "${CPACK_PACKAGE_NAME}-${VERSION}-${CPACK_SYSTEM_NAME}")
# Debian packaging
# TODO: add dependencies (on other debian packages: boost)
#SET(CPACK_DEBIAN_PACKAGE_SECTION Science)

INCLUDE(CPack)
