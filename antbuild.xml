<project name="nemo" default="jar">

	<description>
		Builds java interface for the nemo neural network simulator
	</description>

	<!-- To get the build to work, copy all sources (hand-written +
	     auto-generated thrift code) to a single directory in the build tree -->
	<target name="copy-sources">
		<mkdir dir="dist/build/java/src/nemo"/>
		<copy todir="dist/build/java/src">
			<fileset dir="src/thrift/gen-java"/> <!-- these must be generated externally -->
			<fileset dir="src/ExternalClient/java/src"/>
		</copy>
	</target>

	<target name="compile" depends="copy-sources"> 
		<mkdir dir="dist/build/java/classes"/>
		<javac srcdir="dist/build/java/src" destdir="dist/build/java/classes">
			<classpath>
				<pathelement location="src/ExternalClient/java/lib/libthrift.jar"/>
				<pathelement location="src/ExternalClient/java/lib/slf4j-api-1.5.8.jar"/>
				<pathelement location="src/ExternalClient/java/lib/log4j-1.2.15.jar"/>
			</classpath>
		</javac>
	</target>

	<!-- jar file for nemo with dependencies on thrift and slf4j -->
	<target name="nemo" depends="compile">
		<mkdir dir="dist/build/java/jar_tmp"/>	
		<jar destfile="dist/build/java/jar_tmp/nemo_base.jar" basedir="dist/build/java/classes"/>
	</target>

	<!-- merge our own jar file with libraries to create a stand-alone jar -->
	<target name="jar" depends="nemo">
		<mkdir dir="dist/build/matlab/java"/>	
		<zip destfile="dist/build/matlab/java/nemo.jar">
			<zipgroupfileset dir="dist/build/java/jar_tmp" includes="*.jar"/>
			<zipgroupfileset dir="src/ExternalClient/java/lib" includes="*.jar"/>
		</zip>
	</target>

	<target name="clean">
		<delete dir="build"/>
	</target>

</project>
