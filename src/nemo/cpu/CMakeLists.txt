OPTION(NEMO_CPU_MULTITHREADED "Use multithreaded CPU backend" OFF)

SET(SOURCES Simulation.cpp Mapper.cpp)


IF(NEMO_CPU_MULTITHREADED)
	FIND_PACKAGE(Boost REQUIRED COMPONENTS thread)
	LIST(APPEND SOURCES "Worker.cpp")
	IF(CAN_SET_THREAD_AFFINITY)
		LIST(APPEND SOURCES "thread_affinity.c")
	ELSE(CAN_SET_THREAD_AFFINITY)
		MESSAGE(WARNING "Cannot set thread affinity on this platform. Multi-threaded code may not perform well")
	ENDIF(CAN_SET_THREAD_AFFINITY)
ENDIF(NEMO_CPU_MULTITHREADED)


INCLUDE_DIRECTORIES(
	${CMAKE_BINARY_DIR}/src  # for configuration files
	${CMAKE_SOURCE_DIR}/src
	${Boost_INCLUDE_DIR}
)

ADD_LIBRARY(nemo_cpu ${SOURCES})
SET_TARGET_PROPERTIES(nemo_cpu PROPERTIES DEFINE_SYMBOL NEMO_CPU_EXPORTS)
TARGET_LINK_LIBRARIES(nemo_cpu nemo_base ${Boost_LIBRARIES})
INSTALL(TARGETS nemo_cpu DESTINATION ${INSTALL_LIB_DIR})
